### Шаги установки и запуска

```
composer install
```
```
cp .env.example .env
```
```
git submodule init && git submodule update
```
``` 
cp .laradock.env laradock/.env
```
```
cd laradock
```
``` 
docker-compose up -d nginx postgres
```
``` 
docker-compose exec workspace bash
```
```  
php artisan migrate:fresh
```

 Можно пробовать загружать фотографии через `http://127.0.0.1:8080/api/photos/upload`.
 
 Примеры запросов и ответов:
 [https://documenter.getpostman.com/view/3030666/Rztmr8fS#60c34032-0afc-430d-8a35-492efd5d2036](https://documenter.getpostman.com/view/3030666/Rztmr8fS#60c34032-0afc-430d-8a35-492efd5d2036)
 
 Запуск тестов
 ```  
 vendor/bin/phpunit
 ```

### Комментарии к требованиям

Примечание: ✅ - сделано, ❌ - не сделано

Требования:
- ✅ Возможность загружать несколько файлов.
- ✅ Возможность принимать multipart/form-data запросы.
- ✅ Возможность принимать JSON запросы с BASE64 закодированными изображениями.
- ✅ Возможность загружать изображения по заданному URL (изображение размещено где-то в интернете).
- ✅ Создание квадратного превью изображения размером 100px на 100px.

Пожелания:
- ❌ Корректное завершение приложения при получении сигнала ОС (graceful shutdown). (_Обработка сигналов уместна при запуске в CLI режиме, в моем же случае это Nginx + PHP-FPM_)
- ✅ Dockerfile и docker-compose.yml, которые позволяют поднять приложение единой docker-compose up командой.
- ✅ Функциональные тесты (_tests/Feature_)
- ❌ Модульные тесты (_нет возникло необходимости_)
- ✅ CI интеграция (**Travis CI**, Circle CI, другие).

### Общее описание
Использовал PHP фреймворк Laravel 5.7.

Основная валидация запроса происходит в **app/Http/Requests/PhotoUploadRequest.php**

Дальше контроллер **app/Http/Controllers/Api/PhotoUploadController.php** на основе содержания запроса передает управление нужному обработчику:
- app/Handlers/Base64Encoded.php
- app/Handlers/LocatedByUrl.php
- app/Handlers/Uploaded.php

Каждый обработчик обращается к **app/Handlers/FileSaver.php**, который ответственнен за генерацию превью, сохранение содежримого в файловую и сохранение записи о фотографии в базу данных.
 
Обработчики возвращают модели успешно загруженных файлов и список ошибок. Если какой-то файл не удалось загрузить, то об этом будет добавлена запись в список ошибок, но запрос будет все равно успешным (200).
Дальше с помощью app/Http/Resources/PhotoResource.php отдаем ответ, в котором возвращаем список URLов до оригинала и превью. 

Названия для загруженных файлов генерируется с помощью хэша от микротайма.

Файлы при загрузке помещаются в поддиректории. Это нужно для того, чтобы файловой системе было легче. Чем больше файлов в одной директории, тем ей сложнее ими манипулировать.